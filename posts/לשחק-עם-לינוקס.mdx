---
title: 砖拽 注 拽住
category: 拽住
createdAt: 05.08.2022
description: 
image: https://images.unsplash.com/photo-1640552435388-a54879e72b28?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80

---

## 拽

  专爪转 转 转砖转转 拽 砖.
   专 转砖转转 拽 砖专 驻住 专
(  驻注 转 转 转).
转砖转转 转 转转  拽 拽专  
userspace.
砖专 转转 转 转 转砖转转 转拽转  注转, 专砖转  注 注 砖
Windows.
WSL2
注拽专  专抓
kernel module
  拽爪转 专 拽驻    注专
kernel
专 砖
Windows.
驻爪 砖转 专转  专转  拽  专转 砖
PopOS,
 专  专转 砖 驻转专   专注.
住   砖 驻转 砖
ko
爪注转 砖转/住转, 转拽专   砖 ,  拽专  爪专 
kernel module
砖 转 住专 拽专 专注 驻砖 注砖
panic.
砖 拽专 转 爪专 爪注
reboot

.


转 驻转 爪拽   转 驻砖 驻转专 转专 , 砖专  转 砖转 专
1. 转砖转转 爪专 转  专拽专  专爪转 驻砖专转 爪注 cross-compile 砖 专.
2. 转 砖 爪专转 kernel 注 ko 砖 爪专 转 专.

## qemu
[qemu](https://www.qemu.org/)
 转砖转转   爪 砖   砖住驻专    砖 注转 爪注 爪 专拽专转 砖转.
专   专抓 注 砖
x86
 住抓
mips, 砖 注 注 爪专 专砖 砖.
住祝  砖 爪  注 砖 专  驻转  拽专住 转  爪专 砖.
住 住祝
qemu
 砖 驻砖
process
专  专 砖转  转 拽专 注
gdb! (  拽专 砖砖 住转)

### 转拽 砖砖
转拽 砖
qemu
  驻砖
```bash
sudo apt install qemu-system-x86
```
砖专 转 专  专拽专 砖专爪,  转 驻砖转
(驻砖转 == 转 专拽专  砖 砖,   专专  砖).
qemu
爪驻   驻专专  注转  专抓   转 专注  砖 爪
kernel
注专转 驻注 linux转
 转 专爪.

## 爪专转 专住转 Linux 砖
专  注 驻砖 专 爪转
[gist](https://gist.github.com/chrisdone/02e165a0004be33734ac2334f215380e)
砖  砖住专 转  砖 注 转 注砖转 转.
转 住专 转 拽 砖 砖爪专 注 转 爪专 驻爪转
linux
砖 注爪.

1. kernel - 爪专 拽驻 专住转 kernel.
2. 注专转 拽爪 - 专爪 爪专 注专转 拽爪 砖专 转 专 住住 注 注 linux.
3. init - 住拽专驻 注 砖kernel 拽驻抓  专 砖注专 转 注专转 爪 userspace.

### 拽驻 kernel
转 专 转 source 砖 kernel 
[repo](https://github.com/torvalds/linux/tree/v5.19)
砖 trovalds, 专 转  转 转拽转 `/opt` 砖.
```bash
cd /opt
sudo mkdir linux
# To prevent permission errors
sudo chown nadav linux 

cd linux
# May take some time
git clone git@github.com:torvalds/linux.git . 
```
专 砖专 专  砖转 住 砖 转
```bash
export OPT=/opt
export BUILDS=/home/nadav/projects/hook_infra/builds
mkdir -p $BUILDS
export LINUX=$OPT/linux
export LINUX_BUILD=$BUILDS/linux
mkdir -p $LINUX_BUILD
```
 
砖kernel
转 爪专 专转, 驻砖专转  专抓    拽驻专爪转 砖转  专住 专 砖, 注 砖 转爪专转 砖 砖转.
 砖 注砖转 注 驻 拽抓 拽驻专爪 拽专 `.config`.
注转 驻爪转 专转 转 拽抓  注 注专转 拽爪 `/boot/config-*`
注 转 砖 转 砖专 转 拽驻 砖.
 专爪 转 拽驻专爪 拽  专抓,
```bash
cd $LINUX
make O=$LINUX_BUILD allnoconfig
```
砖专 转 拽抓 砖 砖 砖注,   驻砖专 .
专 砖  砖转 转 拽抓 拽驻专爪   注  注专 砖专  注   拽驻 砖转 转 专抓 ,

```bash
cd $LINUX_BUILD
make menuconfig
```
专 专爪 驻转  住  转 专 转  拽驻专爪转 砖专转 .
 注拽转 专 
[gist](https://gist.github.com/chrisdone/02e165a0004be33734ac2334f215380e)
驻砖专转 转 拽驻专爪转 转

```
64-bit kernel ---> yes
General setup ---> Initial RAM filesystem and RAM disk (initramfs/initrd) support ---> yes
General setup ---> Configure standard kernel features ---> Enable support for printk ---> yes
Executable file formats / Emulations ---> Kernel support for ELF binaries ---> yes
Executable file formats / Emulations ---> Kernel support for scripts starting with #! ---> yes
Device Drivers ---> Generic Driver Options ---> Maintain a devtmpfs filesystem to mount at /dev ---> yes
Device Drivers ---> Generic Driver Options ---> Automount devtmpfs at /dev, after the kernel mounted the rootfs ---> yes
Device Drivers ---> Character devices ---> Enable TTY ---> yes
Device Drivers ---> Character devices ---> Serial drivers ---> 8250/16550 and compatible serial support ---> yes
Device Drivers ---> Character devices ---> Serial drivers ---> Console on 8250/16550 and compatible serial port ---> yes
File systems ---> Pseudo filesystems ---> /proc file system support ---> yes
File systems ---> Pseudo filesystems ---> sysfs file system support ---> yes
Enable loadable module support ---> yes 
```
专 拽驻 转 拽驻 转 拽专,
```bash
make -j8
make modules_prepare
```
砖专 驻拽 专砖 拽驻转 转 拽专 注爪 驻拽 砖 拽驻转 拽爪 砖 砖爪专 注 转 拽驻
ko
砖转砖拽 拽专 砖. 专 住 拽驻 转驻注 注
`Kernel: arch/x86/boot/bzImage is ready`
砖  kernel!

### 转 注专转 拽爪
#### busybox
注专转 拽爪 专爪 专 砖 
`ls`
`cat`
砖专 驻砖专  砖拽 注 拽住 砖. 
[busybox](https://busybox.net/about.html)
 转 专 砖 砖驻爪 转驻爪转 砖
UNIX
砖专  住 转 拽.

专 转 拽
(转专)[https://busybox.net/downloads/]
专 转 砖转  转
```bash
export BUSYBOX=$OPT/busybox
export BUSYBOX_BUILD=$BUILDS/busybox
mkdir -p $BUSYBOX_BUILD
```
注转 转 拽驻 砖专    拽专 砖  专 拽驻专爪转 驻砖专转  转 拽驻 注 专转 专专转 ,
专  砖转砖
`menuconfig`
注 转 拽驻 转 拽驻.

```bash
cd $BUSYBOX
make O=$BUSYBOX_BUILD defconfig

cd $BUSYBOX_BUILD
make menuconfig
```
专  砖砖  拽驻 爪专 住转  砖 砖 住驻专转 注专转 拽爪 砖.
```
Busybox Settings ---> Build Options ---> Build BusyBox as a static binary (no shared libs) ---> yes
```
拽驻 注
`make`
专 
`make install`
注 转 爪专 拽砖专  专.

### 爪专转 注专转 拽爪
爪专 注专转 拽爪 专转 砖 拽住 注转拽 转  拽爪
busybox
砖爪专 .
```bash
export INITRAMFS_BUILD=$BUILDS/initramfs
mkdir -p $INITRAMFS_BUILD
cd $INITRAMFS_BUILD
mkdir -p bin sbin etc proc sys usr/bin usr/sbin
cp -a $BUSYBOX_BUILD/_install/* .
```
住祝 爪专 住拽专驻
`init`
砖专 
kernel
拽驻抓 砖专  注专
userspace.
爪专 转 拽抓 

`$INITRAMFS_BUILD/init`.

```bash
#!/bin/sh

mount -t proc none /proc
mount -t sysfs none /sys

cat <<!


Boot took $(cut -d' ' -f1 /proc/uptime) seconds

        _       _     __ _                  
  /\/\ (_)_ __ (_)   / /(_)_ __  _   ___  __
 /    \| | '_ \| |  / / | | '_ \| | | \ \/ /
/ /\/\ \ | | | | | / /__| | | | | |_| |>  < 
\/    \/_|_| |_|_| \____/_|_| |_|\__,_/_/\_\ 


Welcome to mini_linux


!
exec /bin/sh
```

专 专  专 转  专专转 拽爪 拽抓 专  住专 砖
kernel,
cpio.

```bash
chmod +x init
find . -print0 | cpio --null -ov --format=newc \
  | gzip -9 > $BUILDS/initramfs.cpio.gz
```

 注转 砖  注专转 拽爪!

## 专爪转 qemu
 砖  转  拽爪 砖 爪专 转 专抓 转 驻爪转
linux
砖爪专 注 

```bash
qemu-system-x86_64 -kernel $LINUX_BUILD/arch/x86_64/boot/bzImage \
  -initrd $BUILDS/initramfs.cpio.gz -nographic \
  -append "console=ttyS0"
```

砖专
`<CTRL>a x`
爪 转 住爪.


##### 转拽转 住驻转 砖转 爪专
 拽驻 爪专   专 住驻专转,   砖 转 爪专.
转 注专转 砖  转爪专 转拽 注   拽   砖  爪专 转拽.

```
sudo apt install build-essential flex lebelf-dev
```